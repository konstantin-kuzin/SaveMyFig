<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SaveMy.Fig v 1.2</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="app">
    <div id="update-banner" class="update-banner hidden">
      <div class="update-banner__info">
        <div class="update-banner__title">New version available</div>
        <div class="update-banner__text" id="update-banner-text">Checking for updates...</div>
      </div>
      <div class="update-banner__actions">
        <button id="update-banner-action" class="btn btn-primary border-square">Open GitHub</button>
        <button id="update-banner-dismiss" class="icon-button" aria-label="Close">‚úï</button>
      </div>
    </div>
    <!-- Navigation -->
    <nav class="sidebar">
      <div class="nav-menu">
        <div><a href="#" data-tab="backup" class="nav-link">Backup</a></div>
        <div><a href="#" data-tab="statistics" class="nav-link active">Statistics</a></div>
        <div><a href="#" data-tab="config" class="nav-link">Config</a></div>
        <div><a href="#" data-tab="diagnostics" class="nav-link">Diagnostics</a></div>
      </div>
    </nav>

    

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="main-content">
      <!-- –≠–∫—Ä–∞–Ω —É—Å—Ç–∞–Ω–æ–≤–∫–∏ -->
      <div id="welcome-tab" class="tab-content">
        <div class="tab-body">
          <div id="system-check" class="check-section">
            <h3>System Check</h3>
            <div id="node-status" class="status-item">
              <span class="status-label">Node.js:</span>
              <span class="status-value">Checking...</span>
            </div>
            <div id="npm-status" class="status-item">
              <span class="status-label">npm:</span>
              <span class="status-value">Checking...</span>
            </div>

          </div><br />

          <div id="installation-section" class="install-section">
            <h3>Dependency Installation</h3><br />
            <button id="install-btn" class="btn btn-primary" disabled>
              Install Dependencies
            </button>
            <div id="install-progress" class="progress-container hidden">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <div class="progress-text">Installing...</div>
            </div>
            <div id="install-log" class="log-container hidden">
              <div class="log-content"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ -->
      <div id="config-tab" class="tab-content">
        <div class="tab-body">
          <div id="config-form">
            <!-- FIGMA_ACCESS_TOKEN -->

            <div class="form-group">
              <label for="figma-account-1-email" class="required">Email</label>
              <input type="email" id="figma-account-1-email" name="FIGMA_ACCOUNT_1_EMAIL" placeholder="user@example.com"
                required>
            </div>

            <div class="form-group">
              <label for="figma-account-1-auth-cookie" class="required">FIGMA auth cookie</label>
              <textarea type="text" id="figma-account-1-auth-cookie" name="FIGMA_ACCOUNT_1_AUTH_COOKIE"
                placeholder="__Host-figma.authn=..." required rows="3"></textarea>
              <small class="form-help">
                <a href="https://github.com/alexchantastic/figma-export/wiki/Getting-your-Figma-auth-session-cookie"
                  target="_blank">
                  How to get cookie
                </a>
              </small>
            </div>
            <div class="form-group">
              <label for="figma-access-token" class="required">FIGMA access token</label>
              <input type="text" id="figma-access-token" name="FIGMA_ACCESS_TOKEN" placeholder="figd_..." required>
              <small class="form-help">
                <a href="https://help.figma.com/hc/en-us/articles/8085703771159-Manage-personal-access-tokens"
                  target="_blank">
                  How to get Figma access token
                </a>
              </small>
            </div>


            <!-- DOWNLOAD_PATH -->
            <div class="form-group">
              <label for="download-path" class="required">Download path</label>
              <div style="display: flex; gap: 8px; flex-direction: row; align-items: center">
                <input type="text" id="download-path" name="DOWNLOAD_PATH" placeholder="Select folder" readonly
                  required>
                <button type="button" id="select-path" class="btn btn-secondary border-square">Select</button>
              </div>
            </div>


            <!-- PROJECTS –∏ TEAMS -->
            <div class="form-group">
              <label for="projects">PROJECTS (required if no Teams)</label>
              <textarea id="projects" name="PROJECTS" placeholder="12345, 67890, 12345, 67890" rows="3"></textarea>
            </div>

            <div class="form-group">
              <label for="teams">TEAMS (required if no Projects)</label>
              <textarea id="teams" name="TEAMS" placeholder="12345, 67890, 12345, 67890" rows="3"></textarea>
            </div>

            <div class="form-group">
              <label for="max-files" class="required">MAX_FILES (max 45)</label>
              <input type="text" id="max-files" name="MAX_FILES" placeholder="5" min="1" max="45" required>
              <small class="form-help">Limit of files per run for one backup session</small>
            </div>

            <div class="form-group">
              <label class="required">Debug mode</label>
              <div class="segmented-control" role="group" aria-label="Debug mode">
                <button type="button" class="segment-btn debug-mode-segment active" data-value="off" aria-pressed="true">Off</button>
                <button type="button" class="segment-btn debug-mode-segment" data-value="on" aria-pressed="false">On</button>
              </div>
              <input type="hidden" id="debug-mode" name="DEBUG_MODE" value="off">
              <small class="form-help">Headless Playwright by default; switch on to run headed for debugging.</small>
            </div>


          </div>
        </div>
        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—É—Ç–µ—Ä -->
        <div class="footer">
          <button id="save-config" class="btn btn-primary">Save settings</button>
        </div>
      </div>



      <!-- –≠–∫—Ä–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—ç–∫–∞–ø–∞ -->
      <div id="backup-tab" class="tab-content">
        <div class="tab-body">
          <div class="alert alert-critical">
            <div class="alert-icon">‚ö†Ô∏è</div>
            <div>
              <strong>Warning:</strong> Before starting downloads, open any file in Figma, go to <a href="https://help.figma.com/hc/en-us/articles/360039824334-Open-links-in-the-desktop-app">Preferences</a>, and
              DISABLE "Open link in desktop app". If you skip this, this tool will not work.
            </div>
          </div>
          <div class="log-container">
            <div id="backup-log" class="log-content"></div>
          </div>
        </div>
        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ—É—Ç–µ—Ä -->
        <div class="footer">
          <div style="display: flex; gap: 8px;">
            <button id="start-backup" class="btn btn-primary">Start backup</button>
            <!-- <button id="stop-backup" class="btn btn-danger" disabled>Stop backup</button> -->
            <button id="clear-log" class="btn btn-secondary">Clear log</button>
          </div>
          <div class="status-indicator">
            <span class="status-dot idle"></span>
            <span id="progress-text">Ready to start</span>
          </div>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
      <div id="statistics-tab" class="tab-content active">
        <div class="tab-body">
          <div class="stat-cards">
            <div class="stat-section">
              <div class="stat-value" id="total-files">0</div>
              <div class="stat-label">Total files</div>
            </div>

            <div class="stat-section">
              <div class="stat-value" id="needing-backup">0</div>
              <div class="stat-label">Need backup</div>
            </div>

            <div class="stat-section" style="background-color: var(--bg-danger);">
              <div class="stat-value" id="with-errors">0</div>
              <div class="stat-label">With errors</div>
            </div>
          </div>

          <div class="table-container">
            <div class="table-controls hidden" id="table-controls">
              <input type="search" id="table-search" placeholder="Search by file name" aria-label="Search by file name">
            </div>
            <table id="backups-table">
              <thead>
                <tr>
                  <th data-sort="project_name">Project</th>
                  <th data-sort="file_name" class="file-name-header">
                    <span>File Name</span>
                    <button type="button" id="table-search-toggle" class="icon-button"
                      aria-label="Toggle file name search">üîç</button>
                  </th>
                  <th data-sort="last_backup_date" style="width: 180px;">Last Backup</th>
                  <th data-sort="last_modified_date" style="width: 180px;">Last Modified in Figma</th>
                  <!-- <th data-sort="file_key">File Key</th> -->
                  <th data-sort="next_attempt_date" style="width: 160px;">Next Attempt</th>
                </tr>
              </thead>
              <tbody id="backups-tbody">
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -->
      <div id="diagnostics-tab" class="tab-content">
        <div class="tab-body">
          <div class="diagnostic-section">
            <h3>System Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Node.js version:</label>
                <span id="node-version">Checking...</span>
              </div>
              <div class="info-item">
                <label>Node.js path:</label>
                <span id="node-path">Checking...</span>
              </div>
              <div class="info-item">
                <label>npm version:</label>
                <span id="npm-version">Checking...</span>
              </div>
              <div class="info-item">
                <label>npm path:</label>
                <span id="npm-path">Checking...</span>
              </div>
              <div class="info-item">
                <label>GUI version:</label>
                <span id="gui-version">1.0.0</span>
              </div>
              <div class="info-item">
                <label>Script version:</label>
                <span id="script-version">Checking...</span>
              </div>
            </div>
          </div>

          <div class="diagnostic-section">
            <h3>Dependency Status</h3>
            <div id="deps-status" class="status-list">
              <!-- –°—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>

          <div class="diagnostic-section">
            <h3>Filesystem Access</h3>
            <div id="fs-status" class="status-list">
              <!-- –°—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>

          <div class="diagnostic-section">
            <h3>Figma API Access</h3>
            <div id="api-status" class="status-list">
              <!-- –°—Ç–∞—Ç—É—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
          </div>

          <div class="diagnostic-section">
            <h3>Application Logs</h3>
            <div class="log-controls">
              <button id="refresh-logs" class="btn btn-secondary">Refresh</button>
              <button id="clear-logs" class="btn btn-secondary">Clear</button>
              <button id="open-logs-folder" class="btn btn-secondary">Open folder</button>
            </div>
            <div class="log-container">
              <div id="diagnostic-log" class="log-content"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script type="module" src="../../ui.js"></script>
</body>

</html>
